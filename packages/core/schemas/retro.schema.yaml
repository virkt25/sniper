$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://sniper.ai/schemas/retro"
title: Retrospective Report
description: Schema for SNIPER retrospective reports generated after a lifecycle run completes.
type: object
required:
  - protocol
  - completed_at
properties:
  protocol:
    type: string
    description: The SNIPER protocol version identifier.
  completed_at:
    type: string
    format: date-time
    description: ISO 8601 timestamp of when the lifecycle run completed.
  duration_phases:
    type: array
    description: Per-phase duration and execution summary.
    items:
      type: object
      required:
        - phase
        - agents
        - gate_attempts
        - gate_result
      properties:
        phase:
          type: string
          description: Phase name.
        agents:
          type: integer
          minimum: 0
          description: Number of agents that participated in this phase.
        gate_attempts:
          type: integer
          minimum: 0
          description: Number of times the gate review was attempted.
        gate_result:
          type: string
          enum:
            - pass
            - fail
          description: Final gate review outcome for this phase.
  metrics:
    type: object
    description: Aggregate metrics for the entire lifecycle run.
    properties:
      total_tokens:
        type: integer
        minimum: 0
        description: Total tokens consumed across all phases.
      total_agents_spawned:
        type: integer
        minimum: 0
        description: Total number of agents spawned across all phases.
      gate_pass_rate:
        type: number
        minimum: 0
        maximum: 1
        description: Fraction of gate reviews that passed on the first attempt.
  findings:
    type: object
    description: Retrospective findings and action items.
    properties:
      went_well:
        type: array
        description: Things that went well during the lifecycle run.
        items:
          type: string
      needs_improvement:
        type: array
        description: Areas that need improvement.
        items:
          type: string
      action_items:
        type: array
        description: Concrete action items for future runs.
        items:
          type: string
additionalProperties: false
