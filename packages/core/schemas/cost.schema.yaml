$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://sniper.ai/schemas/cost"
title: Cost Tracking
description: Schema for SNIPER cost tracking that monitors token usage and budget across phases.
type: object
required:
  - protocol
  - started_at
  - budget
properties:
  protocol:
    type: string
    description: The SNIPER protocol version identifier.
  started_at:
    type: string
    format: date-time
    description: ISO 8601 timestamp of when cost tracking began.
  budget:
    type: number
    minimum: 0
    description: Total token budget allocated for the project.
  phases:
    type: array
    description: Per-phase cost breakdown.
    items:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Phase name (e.g. discover, plan, solve, sprint).
        started_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when this phase started.
        completed_at:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when this phase completed.
        tokens_used:
          type: integer
          minimum: 0
          description: Total tokens consumed during this phase.
        agents:
          type: array
          description: Per-agent cost breakdown within this phase.
          items:
            type: object
            required:
              - name
              - tokens_used
            properties:
              name:
                type: string
                description: Agent persona name.
              tokens_used:
                type: integer
                minimum: 0
                description: Tokens consumed by this agent.
  totals:
    type: object
    description: Aggregate cost totals.
    properties:
      tokens_used:
        type: integer
        minimum: 0
        description: Total tokens consumed across all phases.
      budget_remaining:
        type: number
        minimum: 0
        description: Remaining token budget.
      budget_percent_used:
        type: number
        minimum: 0
        maximum: 100
        description: Percentage of budget consumed.
  enforcement:
    type: object
    description: Budget enforcement thresholds expressed as fractions of the total budget.
    properties:
      warn_threshold:
        type: number
        minimum: 0
        maximum: 1
        description: Fraction of budget at which a warning is issued.
      soft_cap:
        type: number
        minimum: 0
        maximum: 1
        description: Fraction of budget at which soft enforcement begins (e.g. require confirmation).
      hard_cap:
        type: number
        minimum: 0
        maximum: 1
        description: Fraction of budget at which execution is halted.
additionalProperties: false
