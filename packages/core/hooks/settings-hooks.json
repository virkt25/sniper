{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write",
        "description": "Enforce lead orchestrator write scope restriction",
        "command": "if echo \"$CLAUDE_TOOL_INPUT\" | grep -q '\"file_path\"' && ! echo \"$CLAUDE_TOOL_INPUT\" | grep -q '.sniper/'; then echo 'BLOCK: Lead orchestrator can only write to .sniper/ directory'; exit 1; fi",
        "agent": "lead-orchestrator"
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Bash",
        "description": "Self-healing CI: detect test/lint failures and instruct agent to fix",
        "command": "if echo \"$CLAUDE_TOOL_OUTPUT\" | grep -qiE '(FAIL|FAILED|ERROR|AssertionError|SyntaxError|TypeError|ReferenceError|lint.*error|eslint.*error|tsc.*error)'; then echo 'WARN: Test or lint failure detected. Fix the failing test/lint issue before proceeding to the next task.'; fi"
      }
    ],
    "Stop": [
      {
        "description": "Run gate reviewer at phase boundaries",
        "command": "if [ -f .sniper/pending-gate.yaml ]; then echo 'Gate review pending — spawning gate-reviewer agent'; fi",
        "agent": "gate-reviewer"
      },
      {
        "description": "Run retro analyst after protocol completion",
        "command": "if [ -f .sniper/protocol-complete.yaml ]; then echo 'Protocol complete — spawning retro-analyst agent'; fi",
        "agent": "retro-analyst"
      }
    ]
  }
}
